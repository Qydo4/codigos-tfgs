#include <SoftwareSerial.h>

const int botonPin = 7;
const int tofTxPin = 2;
const int tofRxPin = 3;

SoftwareSerial ToFSerial(tofRxPin, tofTxPin);

long velocidades[] = {9600, 19200, 38400, 57600, 115200};

void setup() {
  Serial.begin(9600);
  pinMode(botonPin, INPUT_PULLUP);
  Serial.println("Scanner de baudios para el Sensor ToF");
}

void loop() {
  if (digitalRead(botonPin) == LOW) {
    for (int v = 0; v < 5; v++) {
      Serial.print("Probando velocidad: ");
      Serial.println(velocidades[v]);
      
      ToFSerial.begin(velocidades[v]);
      delay(50);

      byte comando[] = { 0x5A, 0x05, 0x00, 0x01, 0x60 };
      for (int i = 0; i < 5; i++) {
        ToFSerial.write(comando[i]);
      }
      
      delay(100);

      Serial.print("Respuesta cruda a ");
      Serial.print(velocidades[v]);
      Serial.print(": ");
      
      int contador = 0;
      while (ToFSerial.available() && contador < 20) {
        byte dato = ToFSerial.read();
        Serial.print("0x");
        if (dato < 16) Serial.print("0");
        Serial.print(dato, HEX);
        Serial.print(" ");
        contador++;
      }
      Serial.println();
    }

    Serial.println("Ciclo completo. Esperando próximo pulso de botón...");
    delay(2000);
  }
}
